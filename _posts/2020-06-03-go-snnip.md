---
layout: post
title: "Go 代码片段"
author: "chan"
date: "2020-06-03"
category: "note"
---

本文记录一些 Go 1.11+ 版本及以上的一些代码片段操作。



### 读文件

1. 一行一行读取文件, 采用 `bufio.Scanner` 进行

```go
package main

import (
    "bufio"
    "fmt"
    "log"
    "os"
)

func main() {
    file, err := os.Open("/path/to/file.txt")
    if err != nil {
        log.Fatal(err)
    }
    defer file.Close()

    scanner := bufio.NewScanner(file)
    for scanner.Scan() {
        fmt.Println(scanner.Text())
    }

    if err := scanner.Err(); err != nil {
        log.Fatal(err)
    }
}
```

上述有一个限制即：每一行的大小有限制，超过 65535 个字节则会报错。

2. 读取整个文件

```go
content, err := ioutil.ReadFile("filename")
if err != nil {
	...
}

# content 是 []byte 类型，可以使用 string(content)  进行转换
```

---

### 遍历目录

深度遍历指定目录，输出绝对路径。

```go
....
import (
	"path/filepath"
)

...
func Walkthrough(cpath string) {
	err := filepath.Walk(cpath, func(path string, info os.FileInfo, err error) error {
		if err != nil {
			return err
		}
		
		fmt.Println(path) 
	})
}

...
```

一些和路径/目录操作相关的小函数

```go
# 是否存在后缀
if strings.HasSuffix(path, ".txt") {
	...
}

# 路径中的 base 
basename := filepath.Base("/aa/bb/xxx.txt")  # 输出 xxx.txt

# 创建目录，类似 mkdir -p
err := os.MkdirAll(path, os.ModePerm)  # 按默认权限创建目录
```



