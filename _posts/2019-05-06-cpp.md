---
layout: post
title: "C/C++ ç¼–è¯‘é—®é¢˜"
author: "Chan"
date: "2019-05-06"
category: "note"
---

### W

æŠ€æœ¯åœ¨æ›´æ–°ï¼Œä¸€äº›åº“ã€å·¥å…·ç­‰ä¹Ÿéƒ½åœ¨è¿›åŒ–ï¼Œç½‘ä¸Šçš„ä¸€äº›æ–‡ç« ç•¥æ˜¾å¾—è¿‡æ—¶ã€‚æ¯æ¬¡éƒ½å» Google æˆ–è€… SOï¼Œ æ‰€ä»¥è®°å½•ä¸€ä¸‹æ–°çš„ä½¿ç”¨æ–¹æ³•æˆ–è€…æ³¨æ„å†…å®¹ï¼Œ é‚ç§°æ‚è®°ã€‚

---

### Jsoncpp

è¿™ä¸ªåº“é‡Œé¢åºŸå¼ƒä¸å°‘çš„æ¥å£ã€‚åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šæç¤ºæŸäº›æ¥å£å·²ä¸¢å¼ƒã€‚æ¯”å¦‚ `-Wdeprecated-declarations` ã€‚ çœ‹ä¸€ä¸‹æºç ä¼šå‘ç°æœ‰è¿™æ ·çš„ä¸€ä¸ªå®ï¼š

```
#define JSONCPP_DEPRECATED(message) __attribute__((deprecated(message)))

```

æ¥ç€åœ¨å®šä¹‰ç±»çš„åœ°æ–¹ä½¿ç”¨ï¼š

```
class JSONCPP_DEPRECATED("Use CharReader and CharReaderBuilder instead.") JSON_API Reader{
	...    
}
```

æ­¤æ—¶åœ¨ç¼–è¯‘æ—¶å°±ä¼šæŠ¥ä¸Šé¢çš„ä¸€ä¸ª warningã€‚

**reader/writer**

æ–°ç‰ˆæœ¬æ›¿æ¢æ‰äº†è€çš„ ` Json::Writerã€Json::FastWriterã€Json::Reader` ç­‰æ¥å£ï¼Œæ‰€ä»¥ç°åœ¨æ˜¯éœ€è¦ä¸€ä¸ªæ–°çš„æ–¹å¼å»å®ç°ï¼Œç®€å•çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š

```
#include <iostream>
#include <memory>
#include <sstream>

//writer
Json::Value val;
Json::StreamWriterBuilder builder;
std::unique_ptr<Json::StreamWriter> writer(builder.newStreamWriter());
std::ostringstream os;

val["name"] = "j";
val["age"] = 27;

writer->writer(val, &os);
std::cout << os.str() << std::endl;

---
// reader
std::string str = os.str();
Json::Value root;
Json::CharReaderBuilder reader;
std::unique_ptr<Json::CharReader> const reader(reader.newCharReader());
const char *pstart = str.c_str();
std::string err;

if(!reader->parse(pstart, pstart+str.length(), &root, &err))
	return false;
	
std::cout << root["name"].asString() << std::endl;
std::cout << root["age"].asInt << std::endl;

```

ä¸è¿‡è¿™ä¸ªæ˜¯å®˜æ–¹çš„åº“ï¼Œåœ¨æ¡ä»¶å…è®¸çš„æƒ…å†µä¸‹è¯•è¯• [rapidJson](https://github.com/Tencent/rapidjson)  ğŸ¤©ã€‚

---

###  GCC ABI é”™è¯¯

è¿™ä¸ªé—®é¢˜ä¸€èˆ¬å‡ºç°åœ¨ GCC4.x ç‰ˆæœ¬ç¼–è¯‘çš„åº“ä¹‹åä½¿ç”¨ GCC5.x ç‰ˆæœ¬å»ç¼–è¯‘çš„æ—¶å€™ä¼šå¸¸è§çš„ä¸€ä¸ªé”™è¯¯ã€‚æ¯”å¦‚ï¼š

```
dgJson::Value::asString[abi:cxx11]() const
```

æç¤ºæ˜¯ `abi:cxx11`ï¼Œè¿™ä¸ªä¸€èˆ¬å°±æ˜¯å‡ºç°äº†å†²çªäº†ï¼ŒåŸå› æ˜¯ `std::string`  åœ¨ç¼–è¯‘å™¨å‡çº§è¿‡ç¨‹ä¸­åšäº†è¿ç§»ï¼Œæ‰€ä»¥æ¥å£å¯¹ä¸ä¸Šäº†ã€‚è§£å†³çš„æ–¹æ³•ä¹Ÿæ¯”è¾ƒç®€å•ã€‚

+ ç”¨ GCC5.X çš„ç‰ˆæœ¬é‡æ–°ç¼–è¯‘ä¸€ä¸‹ä½ éœ€è¦ä½¿ç”¨çš„åº“
+ ç¼–è¯‘æ—¶åŠ ä¸Š**ç¼–è¯‘é€‰é¡¹**ï¼š`-D_GLIBCXX_USE_CXX11_ABI=0`

ç¬¬ä¸€ç§æ–¹æ³•åœ¨ä½ æœ‰æºç çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æ–¹ä¾¿çš„åšåˆ°çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚ç¬¬äºŒç§æ–¹å¼æ˜¯è®¾ç½®ç¼–è¯‘é€‰é¡¹ï¼Œè€Œä¸æ˜¯é“¾æ¥é€‰é¡¹ï¼Œè¿™ä¸€ç‚¹éœ€è¦æ³¨æ„ã€‚