---
layout: post
title: "YUV å›¾ç‰‡æ ¼å¼ä»‹ç»"
author: "Chan"
date: "2019-09-24"
category: "tech"
---

### H

æœ¬æ–‡ä¸»è¦å…³æ³¨ YUV å’Œ JPG è¿™ä¸¤ç§æ ¼å¼ï¼Œç½‘ä¸Šå°‘æœ‰ä¸€äº›å›¾ç‰‡æ ¼å¼ä¹‹é—´çš„è½¬æ¢ï¼Œåå†·é—¨ä¸€ç‚¹çš„æ ¼å¼è½¬æ¢åŸºæœ¬ä¸Šçœ‹ä¸åˆ°è§£å†³æ–¹æ¡ˆã€‚æ‰€ä»¥åœ¨ç†è§£äº†è¿™äº›æ ¼å¼çš„æž„æˆä¹‹åŽï¼Œå°±èƒ½è‡ªå·±æ‰‹åŠ¨å†™ä¸€ä¸ªè½¬æ ¼å¼çš„ç¨‹åºã€‚

### YUV 

YUV é€šå¸¸æˆ‘ä»¬éœ€è¦æ‹†å¼€çœ‹ï¼Œå…¶ä¸­ï¼š

+ Y  è¡¨ç¤ºçš„æ˜¯äº®åº¦ï¼Œæˆ–è€…å¸¸è¯´çš„ç°åº¦ã€‚Luminance
+ UV è¡¨ç¤ºçš„æ˜¯è‰²åº¦ï¼Œæè¿°è‰²å½©å’Œé¥±å’Œåº¦ã€‚Chrominance

è¿™æ ·çš„æ ¼å¼ï¼Œåœ¨åªæœ‰ Y åˆ†é‡çš„æƒ…å†µä¸‹ï¼ŒåŒæ ·å¯ä»¥æè¿°ä¸€å¹…å›¾ç‰‡ï¼Œåªä¸è¿‡æ˜¯ä¸€å¼ é»‘ç™½è‰²çš„å›¾ç‰‡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è¦çŸ¥é“å­˜å‚¨çš„æ ¼å¼ï¼Œä¸€èˆ¬åˆ†ä¸¤ç§ï¼š

+ Planar å³å…ˆå­˜ä¸€ç»„ Y åˆ†é‡ï¼ŒæŽ¥ç€ä¸€ç»„ U åˆ†é‡ï¼Œç»§ç»­ V åˆ†é‡ã€‚
+ Packet å³ YUV åˆ†é‡æ˜¯è¿žç»­äº¤å‰çš„å­˜æ”¾çš„ã€‚

**æ ¼å¼**

é€šå¸¸ YUV æœ‰ 444ï¼Œ 422ï¼Œ 420 è¿™ä¸‰ç§è¡¨è¾¾æ–¹å¼ã€‚ç®€å•çš„å™è¿°å¦‚ä¸‹ï¼š

+ `4:4:4` é‡‡æ ·ï¼Œè¡¨ç¤ºçš„æ˜¯**æ¯**ä¸ª Y åˆ†é‡å¯¹åº”ç€ä¸€ä¸ª UV åˆ†é‡
+ `4:2:2` é‡‡æ ·ï¼Œè¡¨ç¤ºçš„æ˜¯**ä¸¤**ä¸ª Y åˆ†é‡å¯¹åº”ç€ä¸€ä¸ª UV åˆ†é‡
+ `4:2:0` é‡‡æ ·ï¼Œè¡¨ç¤ºçš„æ˜¯**å››**ä¸ª Y åˆ†é‡å¯¹åº”ç€ä¸€ä¸ª UV åˆ†é‡

ä¸€ä¸ªç»å…¸çš„å›¾è¡¨ç¤ºå¦‚ä¸‹ï¼š

![img](https://static.oschina.net/uploads/img/201412/08141454_ACE9.jpg)

å…¶ä¸­é»‘è‰²çš„ç‚¹è¡¨ç¤ºçš„æ˜¯ Y åˆ†é‡ï¼Œç©ºå¿ƒç‚¹è¡¨ç¤ºçš„ UV åˆ†é‡ç»„ã€‚ 

---

### å­˜å‚¨

è¯´å®Œäº†æ ¼å¼ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£åœ¨å®žé™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼ŒYUV æ ¼å¼çš„æ–‡ä»¶æ˜¯å¦‚ä½•å­˜å‚¨çš„ã€‚åœ¨æœ€å¼€å§‹æˆ‘ä»¬æåˆ°äº† Packed å’Œ Planar è¿™ä¸¤ç§æ ¼å¼ï¼Œä¸‹é¢åˆ†åˆ«è¯´ä¸€ä¸‹å¦‚ä½•è¿™ä¸¤ç§æ ¼å¼æ˜¯å¦‚ä½•å­˜å‚¨çš„ã€‚

+  Packed

åœ¨å†…å­˜çš„ä½“çŽ°ä¸­ï¼Œpacked æ˜¯æŒ‰ç…§ YUV è¿™ä¸€ç»„è¿›è¡Œçš„ã€‚å¯¹äºŽ `4:2:2`  è¿™æ ·çš„å¸ƒå±€ï¼Œä¸€èˆ¬æœ‰ YUY2ï¼Œ UYVYã€‚ ç®€å•çš„å¸ƒå±€å¦‚ä¸‹ï¼š

**YUY2**

> Y0|U0|Y1|V0  Y2|U1|Y3|V1  Y4|U2|Y5|V2

**UYVY**

> U0|Y0|V0|Y1 U1|Y2|V1|Y3  U2|Y4|V2|Y5

+ Planar

planar çš„æ ¼å¼åœ¨å†…å­˜æ“ä½œä¸Šå¯èƒ½ä¼šæ¯”è¾ƒçš„å¥½ç†è§£ä¸€äº›ï¼ŒåŸºæœ¬çš„åŽŸåˆ™å°±æ˜¯ä¸‰ä¸ªåˆ†é‡å„è‡ªæŒ‰ç…§ä¸€ç»„æŽ’åˆ—ï¼Œåªæ˜¯åœ¨æ•°é‡ä¸ŠæŒ‰ç…§ä¸€å®šçš„æ¯”ä¾‹è¿›è¡Œã€‚ä¸€èˆ¬æˆ‘ä»¬ä¼šåˆ†ä¸º YUV420Pï¼Œ YUV420SPã€‚å®žé™…ä¸Šæˆ‘ä»¬è¿˜ä¼šæ›´åŠ ç»†åˆ†ã€‚å¦‚ä¸‹ï¼š

> I420 -> YUV420P <- YV12
>
> NV12 -> YUV420SP <-NV21

å†…å­˜çš„å¸ƒå±€å°±å¾ˆç®€å•äº†ï¼Œç¤ºæ„å¦‚ä¸‹ï¼š

```
I420ï¼šYYYYYYYY UU VV 

YV12ï¼šYYYYYYYY VV UU  

NV12ï¼šYYYYYYYY UV UV   

NV21ï¼šYYYYYYYY VU VU  

```

---

### è½¬æ¢

åœ¨äº†è§£äº†å†…å­˜çš„å¸ƒå±€ä¹‹åŽï¼Œåœ¨ YUV æ ¼å¼å†…éƒ¨çš„è½¬æ¢å°±æ˜¯å†…å­˜çš„ç»„åˆï¼Œè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚æ¯”å¦‚ä»Ž YUV420P è½¬æ¢åˆ° YUV420SP å¯ä»¥å†™æˆå¦‚ä¸‹çš„æ–¹å¼ï¼š

```c
	  /* Y--------------------------------------------------*/
    pDst = pLuma;
    for (u32Row = 0; u32Row < u32LumaHeight; ++u32Row)
    {
        fread(pDst, u32Width, 1, pFile);
        pDst += u32LumaStride;
    }

    if (PIXEL_FORMAT_YUV_400 == pstFrame->enPixelFormat)
    {
        return HI_SUCCESS;
    }
    else if (PIXEL_FORMAT_YVU_SEMIPLANAR_420 == pstFrame->enPixelFormat)
    {
        u32ChromaHeight = u32ChromaHeight >> 1;
    }

    pTemp = (HI_U8*)malloc(u32ChromaStride);
    if (HI_NULL == pTemp)
    {
        SAMPLE_PRT("vgs malloc failed!.\n");
        return HI_FAILURE;
    }
    memset(pTemp, 0, u32ChromaStride);

    /* U--------------------------------------------------*/
    pDst = pChroma + 1;
    for (u32Row = 0; u32Row < u32ChromaHeight; ++u32Row)
    {
        fread(pTemp, u32Width/2, 1, pFile);
        for (u32List = 0; u32List < u32ChromaStride; ++u32List)
        {
            *pDst = *(pTemp + u32List);
            pDst += 2;
        }
        pDst = pChroma + 1;
        pDst += (u32Row + 1) * u32LumaStride;
    }

    /* V--------------------------------------------------*/
    pDst = pChroma;
    for (u32Row = 0; u32Row < u32ChromaHeight; ++u32Row)
    {
        fread(pTemp, u32Width/2, 1, pFile);
        for(u32List = 0; u32List < u32ChromaStride; ++u32List)
        {
            *pDst = *(pTemp + u32List);
            pDst += 2;
        }
        pDst = pChroma;
        pDst += (u32Row + 1) * u32LumaStride;
    }

```

è¿™ä¸€æ®µæ˜¯è¯»å–ä¸€ä¸ª YUV420P æ ¼å¼çš„æ–‡ä»¶å¹¶å­˜æˆ NV21 æ ¼å¼ã€‚ ä¸è¿‡æ—¥å¸¸ä¸­å¾ˆå¤šæ ¼å¼å¯ä»¥ç›´æŽ¥å€ŸåŠ©äºŽ openCV æˆ–è€… ffmpeg ç­‰å·¥å…·æˆ–è€…æŽ¥å£ç›´æŽ¥è½¬æ¢çš„ã€‚ç›¸å…³çš„å†…å®¹å¯ä»¥å‚è€ƒ note ä¸­çš„ **å›¾ç‰‡æ“ä½œæ‚è°ˆ**ã€‚

---

### è·‹

åœ¨æ­¤æŽ¨èä¸€ä¸ªä¸é”™çš„ç§‘æ™®å°è§†é¢‘ï¼Œä»¥æ­¤æ¥æ›´å¥½çš„ç†è§£ YUV çš„ç¼–ç æ ¼å¼ã€‚[ðŸ”—åœ¨æ­¤](https://b23.tv/av29270929)ã€‚